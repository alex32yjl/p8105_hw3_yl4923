---
title: "p8105_hw3_yl4923"
output: github_document
---
### Problem 0 

```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)
data("instacart")
data("brfss_smart2010")

library(readxl)
knitr::opts_chunk$set(
  echo = TRUE,
  fig.width = 10,
  fig.asp = .6,
  out.width = "90%")

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

## Problem 1
1.1 data exploration
There are *`r nrow(instacart)`* rows and *`r ncol(instacart)`* columns in the _instacart_ data set. The key variables like *order_id*, *product_id* or *user_id* helps both customers and stores to identify products bought. For instant, in row 1, *user 112108* ordered *Bulgarian Yogurt (product 49302)* which was the first to be added to the cart and was also reordered by this user. This product was placed at *yogurt aisle (aisle_id 120)* in the *dairy & eggs department (department_id 16)*.The order was placed on Thursday between 10-11 am, 9 days after the user's last purchase. 

1.2 aisles
```{r count aisle}
instacart %>% 
  group_by(aisle, aisle_id) %>%
  summarize(n = n()) %>%
  arrange(desc(n)) %>%
  tbl_df()
```
There are *134* different aisles and most items ordered with a count of 150609 is from aisle *fresh vegetables* with id _83_. 

1.3 plot aisles with more 10000 items ordered
```{r plot}
instacart %>% 
  group_by(aisle, department) %>% 
  summarise(n = n()) %>%
  filter(n > 10000) %>% 
  ggplot(aes(x = reorder(aisle, n), y = n, fill = department)) + 
  geom_histogram(position = "dodge", stat = "identity") +
  labs(
    title = "Aisles with more than 10k ordered",
    x = "Aisle",
    y = "Number of items ordered",
    caption = "Instacart data") + 
   theme(axis.text.x = element_text(angle = 90, vjust = 0.25, hjust = 1),
        axis.text = element_text(size = 7.5) )
```

  The histogram shows the number of products in aisles with more than 10k orders as well as colored them which department falls in. Thus, we can tell these aisles by more general categories, which can be easier to find than through their long names.  
  
1.4 a table showing the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”
```{r table 1}
instacart %>%
  filter(aisle == c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
  group_by(aisle, product_name) %>%
  summarize(order_number = n()) %>% 
  filter(order_number == max(order_number)) %>%
  knitr::kable(caption = "Most popular items of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits” ", align = "lccrr")
```
The 3 most popular items are *Light Brown Sugar*, *Organic Grain Free Chicken & Vegetable Dog Food* and *Organic Baby Spinach* with 156, 14 and 3324 times of order respectively.

1.5 a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week
```{r table 2}
instacart %>%
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  select(product_name, order_dow, order_hour_of_day) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(mean_hour = mean(order_hour_of_day)) %>% 
  mutate(order_dow_char = c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat")) %>%
  select(-order_dow) %>% 
  pivot_wider(
    names_from = "order_dow_char", 
    values_from = "mean_hour") %>% 
  knitr::kable(digits = 2,
               caption = "Mean hour of each day at which Pink Lady Apples and Coffee Ice Cream are ordered", 
               align = "lccrr")
```
Pink Lady Apple is mostly ordered around noon on each day of the week, ranging from 11.6 to 13.9 while Coffee Ice Cream is more likely to be ordered in the afternoon, ranging from 12.4 to 15.4 with one exception in the morning at 10.3 by average on Friday.

### Problem 2
2.1 Data cleaning 
```{r data cleaning}
brfss_df =
  brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>% 
  mutate(response = fct_relevel(response, c("Poor", "Fair", "Good", "Very good", "Excellent"))) %>% 
  select(year,
         state = locationabbr,
         location = locationdesc,
         response,
         sample_size,
         data_value)
```


